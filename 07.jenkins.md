# Jenkins 설치

## ubuntu에 Jenkins 설치

■ 0. (옵션)이전 버전 jdk 제거

```sh
sudo apt remove openjdk-17-jdk
sudo apt autoremove
```

■ 1. Jenkins GPG Key 추가[Jenkins Debian Packages](http://pkg.jenkins.io/debian/)

```sh
  sudo wget -O /etc/apt/keyrings/jenkins-keyring.asc \
    https://pkg.jenkins.io/debian/jenkins.io-2026.key
```

■ 2. Jenkins APT 저장소 등록

```sh
  echo "deb [signed-by=/etc/apt/keyrings/jenkins-keyring.asc]" \
    https://pkg.jenkins.io/debian binary/ | sudo tee \
    /etc/apt/sources.list.d/jenkins.list > /dev/null
```

■ 3. Jenkins 설치

```sh
  sudo apt-get update

  # jdk 설치
  sudo apt-get install fontconfig openjdk-21-jre

  #jenkins 설치
  sudo apt-get install jenkins
```

■ 4. Jenkins 서비스 시작 및 자동 실행

```sh
# 서비스 시작
sudo systemctl start jenkins

# 자동실행
sudo systemctl enable jenkins

# 상태확인
sudo systemctl status jenkins

# 8080 포트 LISTEN 여부 확인
netstat -na | grep 8080
```

■ 5. jenkins 실행
브라우저 : http://ip주소:8080

■ 6. init password 확인

```sh
$ sudo cat /var/lib/jenkins/secrets/initialAdminPassword
```

■ 7. jenkins 환경설정

```
- tool
	jdk  -> /opt/java/openjdk
        git,
        maven 3.9 -> install automatically
- plugin
	over ssh  검색해서  Publish Over SSH  플러그인 설치
- system
	Publish over SSH 설정
	 1. key 칸에 pem파일 복사해서 입력
         2. SSH Server :
		name             ==> ec2
		hostname         ==> ip주소
		username         ==> ec2-user
		remote directory ==> /home/ec2-user
```

젠킨스 사용자를 도커 그룹에 추가하고 jenkins 서비스 재시작  
```sh
sudo usermod -aG docker jenkins
ubuntu@ip-172-31-13-233:~$ sudo service jenkins restart
```


## 아마존 리눅스에 Jenkins 설치

## docker 컨테이너를 이용한 Jenkins 설치

```sh
# docker 설치
sudo yum install docker -y
sudo service docker start
sudo usermod -aG docker ec2-user
exit
ssh 접속

# jenkins container 실행
sudo mkdir /home/ec2-user/jenkins
sudo docker run \
--name jenkins \
-d \
-p 8080:8080 \
-p 50000:50000 \
-v /home/ec2-user/jenkins:/var/jenkins_home \
-v /var/run/docker.sock:/var/run/docker.sock \
-u root \
jenkins/jenkins:jts

■ docker 컨테이너 안에 docker 설치

# jenkins container 접속
docker exec -it jenkins /bin/bash

# jdk 경로확인
env
   -> JAVA_HOME 경로 확인  /opt/java/openjdk

# linux 버전 확인
cat /etc/issue

Debian GNU/Linux 12 \n \l

# Docker 설치
## - Old Version Remove
apt-get remove docker docker-engine docker.io containerd runc

## - Setup Repo
apt-get update

apt-get install \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

y 입력

mkdir -p /etc/apt/keyrings

curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg

echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
  $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null

## - Install Docker Engine
apt-get update
apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

y 입력

exit

# 초기 패스워드 확인
$ docker exec jm_jenkins cat /var/jenkins_home/secrets/initialAdminPassword
```
